{% extends 'base.html.twig' %}

{% block title %}Message liste{% endblock %}

{% block body %}
<div class="container-fluid">
    <h2 class="text-center m-3"><span class="badge badge-{{ color }} font-weight-bold text-white">Liste des messages</span></h2>
    <a style="text-decoration:none;" title="nouveau message" href="{{ path('message_new') }}" class="btn-circle btn-{{ color }} mb-3 mt-3"><i class="far fa-envelope text-white fa-1x"></i></a>
    <div class="row">
        <div class="col-3">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-link active" id="nav-unread-tab" data-toggle="tab" href="#nav-unread" role="tab" aria-controls="nav-unread" aria-selected="true">Non lu</a>
                    <a class="nav-link" id="nav-read-tab" data-toggle="tab" href="#nav-read" role="tab" aria-controls="nav-read" aria-selected="false">lu</a>
                    <a class="nav-link" id="nav-important-tab" data-toggle="tab" href="#nav-important" role="tab" aria-controls="nav-important" aria-selected="false">Important</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-unread" role="tabpanel" aria-labelledby="nav-unread-tab" style="height:500px;overflow:auto;">
                    {% include "/message/shared_message/_message_unread.html.twig" %}
                </div>
                <div class="tab-pane fade" id="nav-read" role="tabpanel" aria-labelledby="nav-read-tab" style="height:500px;overflow:auto;">
                    {% include "/message/shared_message/_message_read.html.twig" %}
                </div>
                <div class="tab-pane fade" id="nav-important" role="tabpanel" aria-labelledby="nav-important-tab" style="height:500px;overflow:auto;">
                    {% include "/message/shared_message/_message_important.html.twig" %}
                </div>
            </div>
        </div>
        <div class="col-9">
            <div class="card card-message-content border border-{{ color }} p-2">
                <div >
                    <h3 id="title_mail"></h3>
                    <span id="content_mail"></span>
                    <br>
                    <input type="hidden" name="mail_id" id="mail_id" value=-99>
                                
                </div>
            </div>
        </div>
    </div>



        {# {% for message in messages %}
        
            {% if message.isRead %}
                {% set read = 'message-read' %}
                {% set read_icone = 'far fa-envelope-open text-white' %}
                {% set color_read = 'secondary' %}
            {% else %}
                {% set read = '' %}
                {% set read_icone = 'far fa-envelope text-white' %}
                {% set color_read = 'success' %}

            {% endif %}
                <a onclick="display(this)" data-messageid="{{ message.id }}" href="#" class="card-message-link">
                    <div class="card card-message {{ read }}">
                            <div class="card-header bg-{{ color_read }} text-white font-weight-bold">
                                {{ message.title }}
                                &emsp;<i class="{{ read_icone }}"></i>
                                &emsp;<span id="read_inform"></span>
                            </div>
                        
                        <div class="card-body border border-{{ color_read }}">
                            <span id="message_date">{{ message.dateSend ? message.dateSend|date('d/m/Y H:i') : '' }}</span>
                            <br/>
                            <span id="message_user">{{ message.userFrom.nom }}&ensp;{{ message.userFrom.prenom }}</span>&ensp;
                            {% if message.isImportant %}
                                <i class="fas fa-exclamation-triangle fa-1x text-danger"></i>
                            {% endif %}
                </a>
                {% if message.isRead == 0 %}     
                    <a href="{{ path('mail_read',{id:message.id}) }}" title="marquÃ© comme lu"><i class="fas fa-glasses fa-2x text-info ml-4"></i></a>
                {% endif %}
                    </div>
                </div>
          
                    
        {% endfor %}
        </div>
                <div class="col-9">
                    <div class="card card-message-content border border-{{ color }} p-2">
                        <div >
                            <h3 id="title_mail"></h3>
                            <span id="content_mail"></span>
                            <br>
                            <input type="hidden" name="mail_id" id="mail_id" value=-99>
                            
                        </div>
                    </div>
                </div>
    </div>
</div> #}
{% endblock %}

{% block javascripts %}
<script>

    function display(message) {
           $.ajax ( 
		    {
                url:"{{ path('ajaxDisplayMessage') }}",
                data:{
                    val : message.dataset.messageid
                    },
                dataType :'json',
                method:'POST',
                success : function(mail)
                {
                    console.log(mail.id);
                    html_title = mail.title;
                    html_content = mail.content;
                    $("#title_mail").html(html_title);
                    $("#content_mail").html(html_content);
                    $("#mail_id").val(mail.id);
                    
			    }
		}) 
    }

      
</script>

{% endblock %}
